<!doctype html>
<html>
<head>
    <meta charset="utf-8">
<meta name="description" content="Long way to go">
<meta name="author" content="Xuanwo">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="/dist/css/animate.min.css">
<link rel="stylesheet" href="/dist/css/style.css">
<link rel="stylesheet" href="/dist/css/font-awesome.min.css">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

    <title>  Python | Xuanwo's Blog </title>
</head>
<body id="home">
<div id="menu" class="menu-right">
    <ul>
        <li>
            <form class="menu-search">
                <div class="form-group header">
                    <span>
                    <i class="fa fa-search searchico"></i>
                    <input type="text" placeholder="Blog Search">
                    <a href="#" class="close-menu"><i class="fa fa-close"></i></a>
                        </span>
                </div>
            </form>
        </li>
        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>
        <li><a href="/about"><i class="fa fa-user"></i>About</a></li>
        <li class="submenu">
            <a href="#"><i class="fa fa-book"></i>Categories<b class="caret"></b></a>
            <ul class="submenu-list">
                
                    <li><a href="/categories/Opinion/">Opinion <span
                                    class="badge">41</span></a></li>
                
                    <li><a href="/categories/Exercise/">Exercise <span
                                    class="badge">323</span></a></li>
                
                    <li><a href="/categories/Daily/">Daily <span
                                    class="badge">8</span></a></li>
                
                    <li><a href="/categories/Learn/">Learn <span
                                    class="badge">4</span></a></li>
                
                    <li><a href="/categories/Develop/">Develop <span
                                    class="badge">11</span></a></li>
                
                    <li><a href="/categories/Summary/">Summary <span
                                    class="badge">4</span></a></li>
                
                    <li><a href="/categories/Operate/">Operate <span
                                    class="badge">1</span></a></li>
                
            </ul>
        </li>
        <li class="submenu">
            <a href="#"><i class="fa fa-calendar"></i>Archives <b class="caret"></b></a>
            <ul class="submenu-list"><li class="submenu-list-item"><a class="submenu-list-link" href="/archives/2016/">2016</a></li><li class="submenu-list-item"><a class="submenu-list-link" href="/archives/2015/">2015</a></li><li class="submenu-list-item"><a class="submenu-list-link" href="/archives/2014/">2014</a></li></ul>
        </li>
        <li><a href="contact.html"><i class="fa fa-envelope"></i>Contact</a></li>
    </ul>
</div>
<div id="wrap">
    <div id="main-nav" class="">
    <div class="container">
        <div class="nav-header">
            <a class="nav-brand" href="/">Xuanwo's Blog</a>
            <a class="menu-link nav-icon" href="#"><i class="fa fa-navicon"></i></a>
        </div>
    </div>
</div>
    <section id="hero" class="light-typo">
    <div id="cover-image" class="image-bg animated fadeIn"></div>
    <div class="container welcome-content">
        <div class="middle-text">
            <h1>Coding your future</h1>
            <a class="btn smooth-scroll" href="#start">Get Stated</a>
        </div>
    </div>
</section>
    <div id="start" class="container content">
        
    <div class="row">
        <div class="col-md-10 col-md-offset-1">
            
                
    <article class="clearfix">
        <div class="post-date">
            发表于
            <time datetime="2016-06-16T22:00:00+00:00"
                  content="Jun 16 2016">
                Jun 16 2016
            </time>
            &nbsp;|&nbsp;分类于
            
                
                    <a href="/categories/Develop/" rel="index">
                        Develop
                        
                        
                    </a>
                
            
            <span>
            <a href="/2016/06/16/jade_ims/#disqus_thread" data-disqus-identifier="2016/06/16/jade_ims/">
              <span class="disqus-comment-count" data-disqus-identifier="2016/06/16/jade_ims/"></span>
            </a>
          </span>
        </div>
        <h2><a href="/2016/06/16/jade_ims/">马可波罗珠宝进销存系统开发手记</a></h2>
        
            <p><img src="/imgs/develop/jade-ims-index.png" alt=""></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这个项目从我们这个学期开了<strong>系统分析与设计</strong>这门课之后就开始了，首次创建这个项目是在3月26号，实际上真正的开发时间集中在6月上旬。差不多用两个星期的闲暇时间时间完成了这个简单的进销存系统。这个系统基于Flask框架，使用SQLite3数据库，前端则是使用Bootstrap框架，实现了包括客户，库存，销售，进货等管理子系统。说是管理，其实也就是简单的增加和删除而已。<br>前人经常说，不要重复造轮子。既然有类似于Odoo这样强大的ERP系统珠玉在前，我为什么要再自己造一个功能简单，甚至根本不会有人用的轮子呢？从前我确实是这么想的，但是稍微有一点工作经验之后发现再造轮子的原因有两条：</p>
<ul>
<li>作为一个处在知识积累阶段的学生而言，再造轮子很有必要。不造一次轮子，你就永远不会明白轮子内部的真实构造。很多技术虽然看起来简单，但是想要有一个完善且健壮的实现却有很多坑需要踩。踩这些坑的过程，也正是一个技术人员成长最快的过程。</li>
<li>别人的轮子终究是别人的。你不知道这个轮子最大能承受多少压力，你也不知道这个轮子在什么样的情况下会爆胎。当一个轮子装上企业呼呼向前的列车，再要想把它替换下来是一件很难且成本很高的事情。</li>
</ul>
<p>接下来，讲讲造这个轮子的一些经历吧~</p>
<a id="more"></a>
<h1 id="项目启动"><a href="#项目启动" class="headerlink" title="项目启动"></a>项目启动</h1><p>正如前言中说的，这个项目是系统分析与设计这门课的课程设计，也是贯穿着整个学期的一个主旋律。早在这学期开学之初，我们就知道了自己需要做这样的一个系统。经历了上个学期各种技术炫了半天，最后却只是抄袭各种开源项目草草实现的<a href="https://xuanwo.org/2015/06/30/together-project/">失败</a>，这个学期我务实了很多。从最开始的讨论就一直跟组员强调技术的可行性，基本上否决了所有试图增大项目复杂度的建议，把主题定在了一个纯粹的进销存管理系统。之所以如此，是因为我的观念发生了很大的变化：原来觉得技术的先进是最重要的，开发项目一定要用最现代的技术，最炫目的特效；现在觉得哪怕是一个用VB写出来的能稳定运行的丑陋系统都要胜过采用了种种最新潮技术却漏洞百出根本没法运行的“先进”系统。<br>在讨论到最极端的时候，我甚至想只做一个仓库的管理系统，只包括进库和出库这样的简单功能。这样的态度曾经闹得有一次讨论直接不欢而散，好在组员都是非常Nice的人，在我主动表达歉意之后大度地表示没什么。经过多次讨论之后，我们终于达成了共识，要做一个进销存系统，功能尽可能简单，在实现基础功能的前提下，再考虑加入新的功能。<br>接下来的事情就没有什么大的分歧了，整体系统采用B/S架构，开发语言选用我个人比较喜欢的Python，使用Flask框架，数据库选用无需配置的SQLite。然后服务器选择阿里云的学生机，系统选择成熟稳定的CentOS 7.2，Web Server选用Nginx，也就是我个人目前比较喜欢的开发平台——LESP(Linux, Nginx, SQLite, Python)。</p>
<h1 id="项目细节"><a href="#项目细节" class="headerlink" title="项目细节"></a>项目细节</h1><p>下面再介绍一下项目的细节。</p>
<h2 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h2><p>项目大体上采用了MVC的思想，不过在具体的实现上并没有太过纠结于概念上的东西。所有的网页模板都在<code>templates</code>文件夹下，静态资源都扔到了<code>static</code>目录，使用一个<code>models.py</code>模块来单独存放所有的数据库定义，然后所有的路由以及操作都在<code>views</code>中实现。对于我来说，快速地实现需求才是头等大事，是不是符合正统的MVC理念并不是十分重要。实际上现在这样的结构开发起来感觉也蛮顺手的，需要调整前端的样式和表单就在<code>templates</code>文件夹下操作，需要修改程序的逻辑就去<code>views</code>，他们基本上是一一对应的关系。<a href="https://spacewander.github.io/explore-flask-zh/4-organizing_your_project.html" target="_blank" rel="external">这里</a>有更加清晰的讲解，值得一看。</p>
<h2 id="项目中的问题-amp-解决方案"><a href="#项目中的问题-amp-解决方案" class="headerlink" title="项目中的问题&amp;解决方案"></a>项目中的问题&amp;解决方案</h2><h3 id="在Flask框架中同时使用蓝图与Flask-SQLAlchemy"><a href="#在Flask框架中同时使用蓝图与Flask-SQLAlchemy" class="headerlink" title="在Flask框架中同时使用蓝图与Flask_SQLAlchemy"></a>在Flask框架中同时使用蓝图与Flask_SQLAlchemy</h3><p><a href="https://segmentfault.com/q/1010000005640527" target="_blank" rel="external">https://segmentfault.com/q/1010000005640527</a></p>
<p><em>感谢@Ethan和@，他们强有力地向我证明了有师傅带路的好处。</em></p>
<p>这个问题纯粹是因为一直以来都是一个脚本Boy，没有系统性的学习过软件开发导致的。很显然，按照我原来的代码去产生实例，就会导致循环导入的错误。想要解决这样的问题，就需要使用工厂函数去生成实例，而不是自己去生成它。</p>
<p>在<code>__init__.py</code>中添加一个<code>create_app()</code>函数，在函数中进行参数配置，初始化和导入蓝图的操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">bps = [<span class="string">'jade_ims.views.dashboard:dashboard'</span>,</span><br><span class="line">       <span class="string">'jade_ims.views.install:install'</span>,</span><br><span class="line">       <span class="string">'jade_ims.views.login:login'</span>,</span><br><span class="line">       <span class="string">'jade_ims.views.sale:sale'</span>,</span><br><span class="line">       <span class="string">'jade_ims.views.customer:customer'</span>,</span><br><span class="line">       <span class="string">'jade_ims.views.purchase.inputbill:inputbill'</span>,</span><br><span class="line">       <span class="string">'jade_ims.views.purchase.supplier:supplier'</span>,</span><br><span class="line">       <span class="string">'jade_ims.views.stock.enterstockbill:enterstockbill'</span>,</span><br><span class="line">       <span class="string">'jade_ims.views.stock.leavestockbill:leavestockbill'</span>,</span><br><span class="line">       <span class="string">'jade_ims.views.stock.stock:stock'</span></span><br><span class="line">       ]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_app</span><span class="params">()</span>:</span></span><br><span class="line">    app = Flask(__name__)</span><br><span class="line">    app.config.from_object(<span class="string">'config'</span>)</span><br><span class="line">    app.config.from_pyfile(<span class="string">'config.py'</span>)</span><br><span class="line"></span><br><span class="line">    db.init_app(app)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> path <span class="keyword">in</span> bps:</span><br><span class="line">        bp = import_string(path)</span><br><span class="line">        app.register_blueprint(bp)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> app</span><br></pre></td></tr></table></figure>
<h3 id="Flask如何优雅地重定向所有未登录用户到登陆界面"><a href="#Flask如何优雅地重定向所有未登录用户到登陆界面" class="headerlink" title="Flask如何优雅地重定向所有未登录用户到登陆界面"></a>Flask如何优雅地重定向所有未登录用户到登陆界面</h3><p><a href="https://segmentfault.com/q/1010000005645821" target="_blank" rel="external">https://segmentfault.com/q/1010000005645821</a></p>
<p><em>感谢@zwillon和@igaozp</em></p>
<p>有一个Feature是想要把所有未登录的用户都重定向到登录页面。当时手头上的技术方案主要有两种：第一种是自己包装一个装饰器，并添加在每一个视图函数中；第二种是使用第三方库<code>Flask-Login</code>，在视图函数中添加<code>@login_required</code>。但是感觉姿势都不怎么优雅，因为我需要不断地在视图函数中添加这个装饰器，不太符合DRY(Don’t Repeat Yourself)准则。<br>SF的老司机给了我一个相当优雅的方案——Hook到app的<code>before_request</code>方法。也就是这样来实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_need_login</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 检查登录的逻辑</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>我第一次是这样实现的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_need_login</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'logged_in'</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'login.user_login'</span>))</span><br></pre></td></tr></table></figure>
<p>这样就带来了一个问题，对于未登录的用户来说，所有页面都会不断地重定向从而导致整个应用崩溃。因此还需要指定在某些情况下停止重定向，所以我们还需要修改一下<code>check_need_login</code>的逻辑：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_need_login</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'logged_in'</span> <span class="keyword">not</span> <span class="keyword">in</span> session <span class="keyword">and</span> request.endpoint <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">'login.user_login'</span>, <span class="string">'static'</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'login.user_login'</span>))</span><br></pre></td></tr></table></figure>
<p>当<code>session</code>中没有<code>logged_in</code>字段且<code>endpoint</code>不是<code>user_login</code>和<code>static</code>的时候就重定向到登录页面，这样就比较优雅地解决了重定向未登录用户到登陆界面的需求。</p>
<h3 id="flask-sqlalchemy-插入数据时发生错误后如何处理"><a href="#flask-sqlalchemy-插入数据时发生错误后如何处理" class="headerlink" title="flask_sqlalchemy 插入数据时发生错误后如何处理"></a>flask_sqlalchemy 插入数据时发生错误后如何处理</h3><p><a href="https://segmentfault.com/q/1010000005647431" target="_blank" rel="external">https://segmentfault.com/q/1010000005647431</a></p>
<p>在实际开发的过程中发现，如果<code>db.session</code>中添加的记录有问题，在commit的时候会出现一个报错。所以我们需要在出错的时候进行一些处理，以保证程序出错之后还能够正常地运行。网友 @学不会编程的永仲 给出的回答是我应该在form中验证数据的正确性。虽然我相信他的理解可能是正确的，但是不太符合我的哲学，我更加倾向于<strong>让它崩溃，然后处理异常</strong>而不是<strong>事先处理好所有的错误</strong>。<br>通过查阅文档，了解到<code>db.session.rollback()</code>这一函数可以在出错是进行回滚，于是最后的实现变成了这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@supplier.route('/purchase/supplier/add', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_supplier</span><span class="params">()</span>:</span></span><br><span class="line">    form = request.form</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        print(form)</span><br><span class="line">        supplier = Supplier(form[<span class="string">'supplier_name'</span>],</span><br><span class="line">                            form[<span class="string">'supplier_constract'</span>],</span><br><span class="line">                            form[<span class="string">'supplier_phone'</span>],</span><br><span class="line">                            form[<span class="string">'supplier_address'</span>],</span><br><span class="line">                            form[<span class="string">'supplier_remark'</span>])</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            db.session.add(supplier)</span><br><span class="line">            db.session.commit()</span><br><span class="line">            flash(<span class="string">'供应商添加成功！'</span>, <span class="string">'success'</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            db.session.rollback()</span><br><span class="line">            flash(<span class="string">'输入不合法，请重新输入！'</span>, <span class="string">'danger'</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'supplier.list_supplier'</span>))</span><br></pre></td></tr></table></figure>
<h1 id="项目总结"><a href="#项目总结" class="headerlink" title="项目总结"></a>项目总结</h1><p>随着答辩的完成，这个项目进入了尾声。因为很多东西需要去学习，有新的东西需要去探索，所以这个项目也很有可能不会再继续维护了。那么这个项目开源出来的价值在哪里呢？我想，这个项目虽然简单，但它毕竟还算是一个完整的Flask项目，除了<code>flask_sqlalchemy</code>之外没有多余的依赖，非常适合一个跟我一样的Python初学者进行入门学习。如果说有人能够因为这个项目少走一些弯路，少在一些死胡同浪费时间，我想这个项目的价值就已经实现了。如果再往大一点来说，开源的价值也就实现了。<br>如果要我自评的话，我觉得这样的项目应该有60分。之所以给一个及格分，是因为这个项目毕竟实现了需求的大多数功能，也有好好地跑在阿里云的服务器上。丢分的话，大体上是因为这个项目毫无注释，没有安装文档，也没有配置手册，很多东西都是硬编码到了代码中。不仅如此，编程的风格也是相当的不佳，在模板部分缺乏良好的顶层设计，出现了大量的重复代码。这些问题希望自己能在下一个项目中得到一些改善。<br>Anyway，随着这个项目的结束，我的大三生涯也要结束了。接下来是波澜壮阔的实习阶段，希望自己能够在实习的时候多踩一些坑，多走一些弯路，多<br>得到一些来自“长者”的指点。</p>
<h1 id="参考资源"><a href="#参考资源" class="headerlink" title="参考资源"></a>参考资源</h1><ul>
<li><a href="http://docs.jinkan.org/docs/flask/" target="_blank" rel="external">Flask 中文文档 <em>文档略有过时，代码以Github上为准</em></a></li>
<li><a href="https://spacewander.github.io/explore-flask-zh/index.html" target="_blank" rel="external">Flask 之旅</a></li>
<li><a href="http://docs.jinkan.org/docs/flask-sqlalchemy/index.html" target="_blank" rel="external">Flask-SQLALchemy 中文文档</a></li>
</ul>
<h1 id="更新日志"><a href="#更新日志" class="headerlink" title="更新日志"></a>更新日志</h1><ul>
<li>2016年06月17日 首次发布</li>
</ul>

        
        <div class="post-footer">
            
                <div id="eof" class="print-invisible">
                    <hr class="eof">
                </div>
                <div style="float:left;width:50%;text-align:center;margin-bottom:40px;">
                    <a href="/imgs/dachui.jpg" title="微信扫一扫，获取新文章推送" class="fancybox" style="display:block" ;><img
                                alt="微信扫一扫，获取新文章推送" style="display:inline-block;" src="/imgs/dachui.jpg"></a>
          <span class="caption" style="color: #999;display: inline-block;font-size: .9em;text-align: center;">
              微信扫一扫，获取新文章推送
          </span>
                </div>
                <div style="float:left;width:50%;text-align:center;margin-bottom:40px;">
                    <a href="/imgs/wechat.png" title="微信扫一扫，请博主喝咖啡" class="fancybox" style="display:block;"><img
                                alt="微信扫一扫，请博主喝咖啡" style="display:inline-block;" src="/imgs/wechat.png"></a>
          <span class="caption" style="color: #999;display: inline-block;font-size: .9em;text-align: center;">
              微信扫一扫，请博主喝咖啡
          </span>
                </div>
                <div class="copyright" style="clear:both;">
                    <p><span>本文标题:</span><a href="/2016/06/16/jade_ims/">马可波罗珠宝进销存系统开发手记</a></p>
                    <p><span>文章作者:</span><a href="/" title="访问 Xuanwo 的个人博客">Xuanwo</a></p>
                    <p><span>发布时间:</span>2016年6月16日 - 22时06分</p>
                    <p><span>最后更新:</span>2016年6月21日 - 17时06分</p>
                    <p><span>原始链接:</span><a href="/2016/06/16/jade_ims/"
                                            title="马可波罗珠宝进销存系统开发手记">https://xuanwo.org/2016/06/16/jade_ims/</a></p>
                    <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license"
                                                                                   href="http://creativecommons.org/licenses/by-nc/4.0/"
                                                                                   title="Attribution-NonCommercial 4.0 International (CC BY-NC 4.0)">Attribution-NonCommercial
                            4.0</a></p>
                    <p><span>转载请保留以上信息。</span></p>
                </div>
            
            
                <div class="post-tags">
                    
                        <a href="/tags/Information/"> #Information </a>
                    
                        <a href="/tags/项目/"> #项目 </a>
                    
                        <a href="/tags/Python/"> #Python </a>
                    
                        <a href="/tags/Flask/"> #Flask </a>
                    
                        <a href="/tags/HTML/"> #HTML </a>
                    
                        <a href="/tags/JavaScript/"> #JavaScript </a>
                    
                </div>
            
        </div>

    </article>



            
                
    <article class="clearfix">
        <div class="post-date">
            发表于
            <time datetime="2015-11-03T15:24:06+00:00"
                  content="Nov 3 2015">
                Nov 3 2015
            </time>
            &nbsp;|&nbsp;分类于
            
                
                    <a href="/categories/Develop/" rel="index">
                        Develop
                        
                        
                    </a>
                
            
            <span>
            <a href="/2015/11/03/python-packages/#disqus_thread" data-disqus-identifier="2015/11/03/python-packages/">
              <span class="disqus-comment-count" data-disqus-identifier="2015/11/03/python-packages/"></span>
            </a>
          </span>
        </div>
        <h2><a href="/2015/11/03/python-packages/">Python包分发详解</a></h2>
        
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>用Python写过不少的脚本，现在要把脚本打包成模块并进行发布，然后才明白脚本Boy到正规的码农差距有多大= =。<br>踩了很多天的坑之后，自己学习到了Python的包分发机制，以及如何利用Pypi向全世界分发自己的模块。现在简单地做一些整理。</p>
<a id="more"></a>
<h1 id="Python包机制"><a href="#Python包机制" class="headerlink" title="Python包机制"></a>Python包机制</h1><blockquote>
<p>包是一个模块或模块/子模块的集合，一般情况下被压缩到一个压缩包中。<br>其中包含</p>
<ol>
<li>依赖信息</li>
<li>将文件拷贝到标准的包搜索路径的指令。</li>
<li>编译指令(如果在安装前代码必须被编译的话)。</li>
</ol>
</blockquote>
<p>也就是说，为了分发模块，我们需要把模块的依赖信息和模块一起打包。在Python中，这个打包好的可分发的文件一般以<code>.egg</code>结尾，其作用可以理解为java中的jar。Python的包管理以及分发曾经经历过非常混乱的一段时期，但是如今已经基本稳定（或者说，流行？）为两个套件：</p>
<ul>
<li>打包&amp;分发：<a href="https://pythonhosted.org/setuptools/" target="_blank" rel="external">Setuptools</a></li>
<li>安装&amp;管理：<a href="https://pip.readthedocs.org/en/stable/" target="_blank" rel="external">pip</a></li>
</ul>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h2 id="注册Pypi"><a href="#注册Pypi" class="headerlink" title="注册Pypi"></a>注册Pypi</h2><blockquote>
<p>Pypi - the Python Package Index<br>Pypi是Python语言包的仓库，全世界所有开源Python开发者都会在Pypi上提交&amp;下载软件包</p>
</blockquote>
<p>为了我们后续的提交操作，我们需要首先<a href="https://pypi.python.org/pypi?%3Aaction=register_form" target="_blank" rel="external">注册</a>一个Pypi的账号，注册非常简单，提供用户名，密码以及邮箱，经过验证之后就注册完成了。</p>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><p>Python没有严格的工程目录要求，只要有<code>__init__.py</code>在的地方，就会被认为是一个Python的包。但是出于方便协作考虑，可以把自己的源代码与各种脚本分开存放。具体的结构可以学习Github上比较流行的Python项目，选择自己喜欢的即可。</p>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p>首先你需要有pip，pip自从<code>3.4</code>版本开始已经随python内置发布，如果使用的版本比较低，可以自己手动进行安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-pip</span><br></pre></td></tr></table></figure>
<p>然后我们需要安装<code>setuptools</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install setuptools</span><br></pre></td></tr></table></figure>
<h1 id="编写安装脚本"><a href="#编写安装脚本" class="headerlink" title="编写安装脚本"></a>编写安装脚本</h1><p>准备工作就绪之后，我们就可以开始编写安装脚本了。</p>
<h2 id="填写配置信息"><a href="#填写配置信息" class="headerlink" title="填写配置信息"></a>填写配置信息</h2><h3 id="基本框架"><a href="#基本框架" class="headerlink" title="基本框架"></a>基本框架</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup, find_packages <span class="comment"># 引入setuptools包</span></span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    option = values, <span class="comment"># 本质上是一个函数的参数，分行写便于维护</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="参数介绍"><a href="#参数介绍" class="headerlink" title="参数介绍"></a>参数介绍</h3><h4 id="指定整个包"><a href="#指定整个包" class="headerlink" title="指定整个包"></a>指定整个包</h4><h4 id="指定单独模块"><a href="#指定单独模块" class="headerlink" title="指定单独模块"></a>指定单独模块</h4><h4 id="依赖关系"><a href="#依赖关系" class="headerlink" title="依赖关系"></a>依赖关系</h4><h4 id="包内数据"><a href="#包内数据" class="headerlink" title="包内数据"></a>包内数据</h4><h4 id="其他数据"><a href="#其他数据" class="headerlink" title="其他数据"></a>其他数据</h4><h4 id="Meta-Data"><a href="#Meta-Data" class="headerlink" title="Meta-Data"></a>Meta-Data</h4><table>
<thead>
<tr>
<th>Meta-Data</th>
<th>描述值</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>包名</td>
</tr>
<tr>
<td><code>version</code></td>
<td>此次发布版本</td>
</tr>
<tr>
<td><code>author</code></td>
<td>作者名</td>
</tr>
<tr>
<td><code>author_email</code></td>
<td>作者邮箱</td>
</tr>
<tr>
<td><code>maintainer</code></td>
<td>维护者名</td>
</tr>
<tr>
<td><code>maintainer_email</code></td>
<td>维护者邮箱</td>
</tr>
<tr>
<td><code>url</code></td>
<td>主页</td>
</tr>
<tr>
<td><code>description</code></td>
<td>简要描述</td>
</tr>
<tr>
<td><code>long_description</code></td>
<td>详细描述</td>
</tr>
<tr>
<td><code>download_url</code></td>
<td>下载地址</td>
</tr>
<tr>
<td><code>classifiers</code></td>
<td>分类，参见<a href="https://pypi.python.org/pypi?%3Aaction=list_classifiers" target="_blank" rel="external">此处</a></td>
</tr>
<tr>
<td><code>platforms</code></td>
<td>平台列表</td>
</tr>
<tr>
<td><code>license</code></td>
<td>授权协议</td>
</tr>
</tbody>
</table>
<h3 id="典型配置"><a href="#典型配置" class="headerlink" title="典型配置"></a>典型配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup, find_packages</span><br><span class="line">setup(</span><br><span class="line">    name = <span class="string">"HelloWorld"</span>,</span><br><span class="line">    version = <span class="string">"0.1"</span>,</span><br><span class="line">    packages = find_packages(),</span><br><span class="line">    scripts = [<span class="string">'say_hello.py'</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Project uses reStructuredText, so ensure that the docutils get</span></span><br><span class="line">    <span class="comment"># installed or upgraded on the target machine</span></span><br><span class="line">    install_requires = [<span class="string">'docutils&gt;=0.3'</span>],</span><br><span class="line"></span><br><span class="line">    package_data = &#123;</span><br><span class="line">        <span class="comment"># If any package contains *.txt or *.rst files, include them:</span></span><br><span class="line">        <span class="string">''</span>: [<span class="string">'*.txt'</span>, <span class="string">'*.rst'</span>],</span><br><span class="line">        <span class="comment"># And include any *.msg files found in the 'hello' package, too:</span></span><br><span class="line">        <span class="string">'hello'</span>: [<span class="string">'*.msg'</span>],</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># metadata for upload to PyPI</span></span><br><span class="line">    author = <span class="string">"Me"</span>,</span><br><span class="line">    author_email = <span class="string">"me@example.com"</span>,</span><br><span class="line">    description = <span class="string">"This is an Example Package"</span>,</span><br><span class="line">    license = <span class="string">"PSF"</span>,</span><br><span class="line">    keywords = <span class="string">"hello world example examples"</span>,</span><br><span class="line">    url = <span class="string">"http://example.com/HelloWorld/"</span>,   <span class="comment"># project home page, if any</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># could also include long_description, download_url, classifiers, etc.</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h2><blockquote>
<p>这个坑踩了很久- -，没有老司机的带的痛苦<br>与开发环境不同的时候，当用户运行你的包时，使用open等命令是以当前目录为根运行的，所以你必须指定数据所在位置，否则会出现IOError甚至更糟糕的情况</p>
</blockquote>
<h3 id="指定需要分发的文件"><a href="#指定需要分发的文件" class="headerlink" title="指定需要分发的文件"></a>指定需要分发的文件</h3><p><strong>自动处理</strong></p>
<p>当没有<code>MANIFEST.in</code>文件时，Setuptools将会按照下面的原则处理文件：</p>
<ul>
<li>所有<code>py_modules</code>和<code>packages</code>选项包含的Python源文件</li>
<li>所有<code>ext_modules</code>或<code>libraries</code>选项指定的C源文件</li>
<li><code>scripts</code>指定的脚本（<em>参见<a href="https://docs.python.org/3.5/distutils/setupscript.html#distutils-installing-scripts" target="_blank" rel="external">Installing Scripts</a></em>）</li>
<li>形如<code>test/test*.py</code>的文件</li>
<li><code>README.txt</code>（或<code>README</code>），<code>setup.py</code>和<code>setup.cfg</code></li>
<li>符合<code>package_data</code>选项的所有文件（<em>参见<a href="https://docs.python.org/3.5/distutils/setupscript.html#distutils-installing-package-data" target="_blank" rel="external">Installing Package Data</a></em>）</li>
<li>符合<code>data_files</code>选项的所有文件（<em>参见<a href="https://docs.python.org/3.5/distutils/setupscript.html#distutils-additional-files" target="_blank" rel="external">Installing Additional Files</a></em>）</li>
</ul>
<p><em>翻译自<a href="https://docs.python.org/3.5/distutils/sourcedist.html#specifying-the-files-to-distribute" target="_blank" rel="external">Python官方文档 Specifying the files to distribute</a></em></p>
<p><strong>手动处理</strong></p>
<p>一般而言，自动处理已经足够，但是如果想要自己指定的话，则需要编辑<code>MANIFEST.in</code>模板文件。<br><code>MANIFEST.in</code>模板文件很简单，每一行都导入或者导出表示符合正则的一类文件。比如说：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 导入根目录下满足*.txt的文件</span><br><span class="line">include *.txt</span><br><span class="line"># 递归导入examples目录下满足*.txt和*.py的文件</span><br><span class="line">recursive-include examples *.txt *.py</span><br><span class="line"># 导入满足examples/sample?/build的文件夹下所有文件</span><br><span class="line">prune examples/sample?/build</span><br></pre></td></tr></table></figure>
<p><em>详细语法参见<a href="https://docs.python.org/3.5/distutils/commandref.html#sdist-cmd" target="_blank" rel="external">此处</a></em></p>
<blockquote>
<p>注意：<br>当根目录下存在<code>MANIFEST.in</code>文件时，Setuptools将不会再采用自动处理的设定，因此需要在<code>MANIFEST.in</code>文件中指明所有需要导入的文件。</p>
</blockquote>
<h3 id="调用数据"><a href="#调用数据" class="headerlink" title="调用数据"></a>调用数据</h3><p>当你需要调用Python包中的文件时，你可以使用下面的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pkg_resources <span class="keyword">import</span> resource_string</span><br><span class="line">data = resource_string(__name__, <span class="string">'data.dat'</span>)</span><br></pre></td></tr></table></figure>
<p>此时，指定的<code>data.dat</code>文件将会以二进制文件流的形式赋值到data变量中，你可以按照自己的需要进行进一步处理。比如说：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from pkg_resources import resource_string</span><br><span class="line">    data = resource_string(__name__, &apos;example.yml&apos;)</span><br><span class="line">    with open(&apos;config.yml&apos;, &apos;w&apos;) as f:</span><br><span class="line">        f.write(str(data, encoding=&apos;utf-8&apos;))</span><br><span class="line">        f.close()</span><br></pre></td></tr></table></figure>
<p>上述代码实现了从<code>example.yml</code>中读取数据并保存到<code>config.yml</code>文件中。</p>
<h3 id="创建源码分发包"><a href="#创建源码分发包" class="headerlink" title="创建源码分发包"></a>创建源码分发包</h3><p>在包的根目录下执行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py sdist</span><br></pre></td></tr></table></figure>
<p>默认情况下，<code>sdist</code>命令将会为Unix创建<code>gzip</code>压缩文件，为Windows创建<code>zip</code>压缩文件<br>你也可以添加参数<code>--formats=zip</code>指定生成的文件类型，所有支持的参数见<a href="https://docs.python.org/3.5/distutils/sourcedist.html" target="_blank" rel="external">此处</a></p>
<blockquote>
<p>源码分发似乎不会导入<code>package_data</code>中指定的数据，如果上传本分发包可能导致用户通过<code>pip</code>安装的包中没有需要的数据。</p>
</blockquote>
<h3 id="创建二进制分发包"><a href="#创建二进制分发包" class="headerlink" title="创建二进制分发包"></a>创建二进制分发包</h3><p>除了创建源码分发之外，我们还可以创建基于平台的二进制分发包。<br>在包的根目录下执行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py bdist</span><br></pre></td></tr></table></figure>
<p>默认情况下，这个命令将会创建基于自身平台的分发包。<br>同样的，你也可以添加<code>--format=zip</code>参数来指定生成的文件，支持的参数见<a href="https://docs.python.org/3.5/distutils/builtdist.html" target="_blank" rel="external">此处</a><br>除此之外，也可以使用以下的命令直接生成对应格式的分发包：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>格式</th>
</tr>
</thead>
<tbody>
<tr>
<td>bdist_dumb</td>
<td>tar, gztar, bztar, xztar, ztar, zip</td>
</tr>
<tr>
<td>bdist_rpm</td>
<td>rpm, srpm</td>
</tr>
<tr>
<td>bdist_wininst</td>
<td>wininst</td>
</tr>
<tr>
<td>bdist_msi</td>
<td>msi</td>
</tr>
</tbody>
</table>
<blockquote>
<p>这一命令无法跨平台， 在Linux上选择制作<code>wininst</code>分发包时会提示缺乏相应的支持。</p>
</blockquote>
<h3 id="创建wheel分发包"><a href="#创建wheel分发包" class="headerlink" title="创建wheel分发包"></a>创建wheel分发包</h3><p>wheel是新出的分发格式，旨在取代egg，你可以通过下列命令进行安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install wheel</span><br></pre></td></tr></table></figure>
<p>然后在包的根目录下执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.ppy bdist_wheel</span><br></pre></td></tr></table></figure>
<h1 id="上传到Pypi"><a href="#上传到Pypi" class="headerlink" title="上传到Pypi"></a>上传到Pypi</h1><h2 id="注册包"><a href="#注册包" class="headerlink" title="注册包"></a>注册包</h2><p>在上传我们的包之前，我们需要首先向Pypi提交包的相关信息。<br>在包的根目录下执行:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py register</span><br></pre></td></tr></table></figure></p>
<p>没有登陆的话，需要进行登陆；如果已经登陆，直接回车使用默认设置即可。</p>
<h2 id="上传包"><a href="#上传包" class="headerlink" title="上传包"></a>上传包</h2><p>注册完毕后，我们可以提交我们的包了。<br>在包的根目录下执行：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py sdist bdist_wininst upload</span><br></pre></td></tr></table></figure></p>
<p>这条命令将会向Pypi提交源码和Win下的安装包，如果需要上传别的包，只要直接写出即可。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="https://github.com/dccrazyboy/pyeco/blob/master/pyeco.rst" target="_blank" rel="external">Python开发生态环境简介</a></li>
<li><a href="http://timd.cn/2015/10/20/setuptools/" target="_blank" rel="external">使用Setuptools构建和分发python包</a></li>
<li><a href="http://python3-cookbook.readthedocs.org/zh_CN/latest/c10/p08_read_datafile_within_package.html" target="_blank" rel="external">10.8 读取位于包中的数据文件</a></li>
<li><a href="https://docs.python.org/3.5/distutils/sourcedist.html" target="_blank" rel="external">Creating a Source Distribution</a></li>
<li><a href="https://docs.python.org/3.5/distutils/examples.html" target="_blank" rel="external">Examples</a></li>
</ul>
<h1 id="更新日志"><a href="#更新日志" class="headerlink" title="更新日志"></a>更新日志</h1><ul>
<li>2015年11月03日 初步完成</li>
<li>2016年03月30日 修复了部分笔误，添加了一些注释，增加了wheel相关的内容</li>
</ul>

        
        <div class="post-footer">
            
                <div id="eof" class="print-invisible">
                    <hr class="eof">
                </div>
                <div style="float:left;width:50%;text-align:center;margin-bottom:40px;">
                    <a href="/imgs/dachui.jpg" title="微信扫一扫，获取新文章推送" class="fancybox" style="display:block" ;><img
                                alt="微信扫一扫，获取新文章推送" style="display:inline-block;" src="/imgs/dachui.jpg"></a>
          <span class="caption" style="color: #999;display: inline-block;font-size: .9em;text-align: center;">
              微信扫一扫，获取新文章推送
          </span>
                </div>
                <div style="float:left;width:50%;text-align:center;margin-bottom:40px;">
                    <a href="/imgs/wechat.png" title="微信扫一扫，请博主喝咖啡" class="fancybox" style="display:block;"><img
                                alt="微信扫一扫，请博主喝咖啡" style="display:inline-block;" src="/imgs/wechat.png"></a>
          <span class="caption" style="color: #999;display: inline-block;font-size: .9em;text-align: center;">
              微信扫一扫，请博主喝咖啡
          </span>
                </div>
                <div class="copyright" style="clear:both;">
                    <p><span>本文标题:</span><a href="/2015/11/03/python-packages/">Python包分发详解</a></p>
                    <p><span>文章作者:</span><a href="/" title="访问 Xuanwo 的个人博客">Xuanwo</a></p>
                    <p><span>发布时间:</span>2015年11月3日 - 15时11分</p>
                    <p><span>最后更新:</span>2016年6月21日 - 17时06分</p>
                    <p><span>原始链接:</span><a href="/2015/11/03/python-packages/"
                                            title="Python包分发详解">https://xuanwo.org/2015/11/03/python-packages/</a></p>
                    <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license"
                                                                                   href="http://creativecommons.org/licenses/by-nc/4.0/"
                                                                                   title="Attribution-NonCommercial 4.0 International (CC BY-NC 4.0)">Attribution-NonCommercial
                            4.0</a></p>
                    <p><span>转载请保留以上信息。</span></p>
                </div>
            
            
                <div class="post-tags">
                    
                        <a href="/tags/Python/"> #Python </a>
                    
                </div>
            
        </div>

    </article>



            
                
    <article class="clearfix">
        <div class="post-date">
            发表于
            <time datetime="2015-10-30T23:47:23+00:00"
                  content="Oct 30 2015">
                Oct 30 2015
            </time>
            &nbsp;|&nbsp;分类于
            
                
                    <a href="/categories/Develop/" rel="index">
                        Develop
                        
                        
                    </a>
                
            
            <span>
            <a href="/2015/10/30/python-JSON/#disqus_thread" data-disqus-identifier="2015/10/30/python-JSON/">
              <span class="disqus-comment-count" data-disqus-identifier="2015/10/30/python-JSON/"></span>
            </a>
          </span>
        </div>
        <h2><a href="/2015/10/30/python-JSON/">在Python中使用JSON</a></h2>
        
            <h1 id="JSON介绍"><a href="#JSON介绍" class="headerlink" title="JSON介绍"></a>JSON介绍</h1><p>JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式。 易于人阅读和编写。同时也易于机器解析和生成。 它基于JavaScript Programming Language, Standard ECMA-262 3rd Edition - December 1999的一个子集。 JSON采用完全独立于语言的文本格式，但是也使用了类似于C语言家族的习惯（包括C, C++, C#, Java, JavaScript, Perl, Python等）。 这些特性使JSON成为理想的数据交换语言。</p>
<p><em>引用自<a href="http://www.json.org/json-zh.html" target="_blank" rel="external">json.org</a></em></p>
<a id="more"></a>
<h1 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h1><h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p>JSON只提供了两种结构——字典和数组。也就是说，JSON可以存储一对一或者一对多的键值对关系。</p>
<h2 id="形式"><a href="#形式" class="headerlink" title="形式"></a>形式</h2><h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><p>对象是一个无序的键值对集合。<br>一个对象以<code>{</code>开始，<code>}</code>结束。每个<code>键</code>后跟一个<code>:</code>；键值对之间使用<code>,</code>分隔。<br><img src="/imgs/develop/object.gif" alt="object"></p>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>数组是值的有序集合，一个键可以对应一个数组。<br>一个数组以<code>[</code>开始，<code>]</code>结束。值之间使用<code>,</code>分隔。<br><img src="/imgs/develop/array.gif" alt="array"></p>
<h3 id="值"><a href="#值" class="headerlink" title="值"></a>值</h3><p>值可以是双引号括起来的字符串、数值、true、false、 null、对象或者数组。这些结构可以嵌套。<br><img src="/imgs/develop/value.gif" alt="value"></p>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p>字符串是由双引号包围的任意数量Unicode字符的集合，使用反斜线转义。一个字符即一个单独的字符串。<br>字符串与C/C++中的字符串非常相似，包括常见的各种转义符号。<br><img src="/imgs/develop/string.gif" alt="value"></p>
<h3 id="数值"><a href="#数值" class="headerlink" title="数值"></a>数值</h3><p>数值与C/C++中的数值非常相似，但没有八进制和十六进制格式。<br><img src="/imgs/develop/number.gif" alt="number"></p>
<h3 id="空白"><a href="#空白" class="headerlink" title="空白"></a>空白</h3><p>空白符号（包括空格，Tab以及回车）可以加入到任何符号之间，不会影响JSON的含义</p>
<h1 id="Python中的JSON库"><a href="#Python中的JSON库" class="headerlink" title="Python中的JSON库"></a>Python中的JSON库</h1><p><em>以Python 3为基准</em></p>
<h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><h3 id="对应类型"><a href="#对应类型" class="headerlink" title="对应类型"></a>对应类型</h3><table>
<thead>
<tr>
<th>Python</th>
<th>JSON</th>
</tr>
</thead>
<tbody>
<tr>
<td>dict</td>
<td>object</td>
</tr>
<tr>
<td>list, tuple</td>
<td>array</td>
</tr>
<tr>
<td>str</td>
<td>string</td>
</tr>
<tr>
<td>int, float</td>
<td>number</td>
</tr>
<tr>
<td>True</td>
<td>true</td>
</tr>
<tr>
<td>False</td>
<td>false</td>
</tr>
<tr>
<td>None</td>
<td>null</td>
</tr>
</tbody>
</table>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>我们使用<code>JSON</code>库中的<code>dump</code>以及<code>dumps</code>函数来进行<code>JSON</code>编码。<code>dump</code>和<code>dumps</code>各项参数含义基本一致，唯一区别在于<code>dump</code>函数编码产生一个JSON文件流，而<code>dumps</code>编码产生一个JSON字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json.dump(obj, fp, skipkeys=<span class="keyword">False</span>, ensure_ascii=<span class="keyword">True</span>, check_circular=<span class="keyword">True</span>, allow_nan=<span class="keyword">True</span>, cls=<span class="keyword">None</span>, indent=<span class="keyword">None</span>, separators=<span class="keyword">None</span>, default=<span class="keyword">None</span>, sort_keys=<span class="keyword">False</span>, **kw)</span><br><span class="line"></span><br><span class="line">json.dumps(obj, skipkeys=<span class="keyword">False</span>, ensure_ascii=<span class="keyword">True</span>, check_circular=<span class="keyword">True</span>, allow_nan=<span class="keyword">True</span>, cls=<span class="keyword">None</span>, indent=<span class="keyword">None</span>, separators=<span class="keyword">None</span>, default=<span class="keyword">None</span>, sort_keys=<span class="keyword">False</span>, **kw)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>obj</code>：编码对象</li>
<li><code>fp</code>：指定文件流</li>
<li><code>skipkeys</code>：若skipkeys为真，则非标准类型将会跳过；否则返回<code>TypeError</code></li>
<li><code>ensure_ascii</code>：若<code>ensure_ascii</code>为真，则输出时将会确保没有非ASCII字符；否则将会原样输出</li>
<li><code>check_circular</code>：若<code>check_circular</code>为真，则将会检测是否存在循环调用；否则会跳过检测</li>
<li><code>allow_nan</code>：若<code>allow_nan</code>为真，则将会允许存在空值（无穷大值）；否则会返回<code>ValueError</code></li>
<li><code>cls</code>：若<code>cls</code>为空值，则使用<code>JSONEncoder</code>；否则使用指定子类进行编码</li>
<li><code>indent</code>：若<code>indent</code>为空值，则无缩进；否则使用指定值进行缩进</li>
<li><code>separators</code>：若<code>separators</code>为空值，则使用<code>(&#39;,&#39;, &#39;: &#39;)</code>分隔；否则使用指定的元组进行分隔</li>
<li><code>default</code>：若<code>default</code>为空值，则使用自带的<code>default</code>方法；否则使用指定值</li>
<li><code>sort_keys</code>：若<code>sort_keys</code>为真，则输出将会按照键进行排序</li>
</ul>
<h3 id="示范"><a href="#示范" class="headerlink" title="示范"></a>示范</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.dumps([<span class="string">'foo'</span>, &#123;<span class="string">'bar'</span>: (<span class="string">'baz'</span>, <span class="keyword">None</span>, <span class="number">1.0</span>, <span class="number">2</span>)&#125;])</span><br><span class="line"><span class="string">'["foo", &#123;"bar": ["baz", null, 1.0, 2]&#125;]'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(json.dumps(&#123;<span class="string">"c"</span>: <span class="number">0</span>, <span class="string">"b"</span>: <span class="number">0</span>, <span class="string">"a"</span>: <span class="number">0</span>&#125;, sort_keys=<span class="keyword">True</span>))</span><br><span class="line">&#123;<span class="string">"a"</span>: <span class="number">0</span>, <span class="string">"b"</span>: <span class="number">0</span>, <span class="string">"c"</span>: <span class="number">0</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分隔符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.dumps([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,&#123;<span class="string">'4'</span>: <span class="number">5</span>, <span class="string">'6'</span>: <span class="number">7</span>&#125;], separators=(<span class="string">','</span>, <span class="string">':'</span>))</span><br><span class="line"><span class="string">'[1,2,3,&#123;"4":5,"6":7&#125;]'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Unicode输出</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.dumps(<span class="string">"\u5317\u4eac"</span>, ensure_ascii=<span class="keyword">False</span>)</span><br><span class="line"><span class="string">'北京'</span></span><br></pre></td></tr></table></figure>
<h2 id="解码"><a href="#解码" class="headerlink" title="解码"></a>解码</h2><h3 id="对应类型-1"><a href="#对应类型-1" class="headerlink" title="对应类型"></a>对应类型</h3><table>
<thead>
<tr>
<th>JSON</th>
<th>Python</th>
</tr>
</thead>
<tbody>
<tr>
<td>object</td>
<td>dict</td>
</tr>
<tr>
<td>array</td>
<td>list</td>
</tr>
<tr>
<td>string</td>
<td>str</td>
</tr>
<tr>
<td>number (int)</td>
<td>int</td>
</tr>
<tr>
<td>number (real)</td>
<td>float</td>
</tr>
<tr>
<td>true</td>
<td>True</td>
</tr>
<tr>
<td>false</td>
<td>False</td>
</tr>
<tr>
<td>null</td>
<td>None</td>
</tr>
</tbody>
</table>
<h3 id="函数-1"><a href="#函数-1" class="headerlink" title="函数"></a>函数</h3><p>我们使用<code>JSON</code>库中的<code>load</code>以及<code>loads</code>函数来进行<code>JSON</code>解码。<code>load</code>和<code>loads</code>各项参数含义基本一致，唯一区别在于<code>load</code>函数用于解码JSON文件流，而<code>loads</code>用于解码JSON字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json.load(fp, cls=<span class="keyword">None</span>, object_hook=<span class="keyword">None</span>, parse_float=<span class="keyword">None</span>, parse_int=<span class="keyword">None</span>, parse_constant=<span class="keyword">None</span>, object_pairs_hook=<span class="keyword">None</span>, **kw)</span><br><span class="line"></span><br><span class="line">json.loads(s, encoding=<span class="keyword">None</span>, cls=<span class="keyword">None</span>, object_hook=<span class="keyword">None</span>, parse_float=<span class="keyword">None</span>, parse_int=<span class="keyword">None</span>, parse_constant=<span class="keyword">None</span>, object_pairs_hook=<span class="keyword">None</span>, **kw)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>fp</code>：指定文件流</li>
<li><code>s</code>：指定字符串</li>
<li><code>encoding</code>：指定字符串编码</li>
<li><code>cls</code>：若<code>cls</code>为空值，则使用<code>JSONEncoder</code>；否则使用指定子类进行编码</li>
<li><code>object_hook</code>：若<code>object_hook</code>为空值，对象则返回解码器<code>dict</code>；否则使用自定义类型返回</li>
<li><code>parse_float</code>：若<code>parse_float</code>为空，则JSON浮点数转换为浮点数；否则转换为指定类型</li>
<li><code>parse_int</code>：若<code>parse_int</code>为空，则JSON整数转换为整数；否则转换为指定类型</li>
<li><code>parse_constant</code>若<code>parse_constant</code>为空，则不会处理非法输入；否则抛出异常</li>
<li><code>object_pairs_hook</code>：若<code>object_pairs_hook</code>为空值，则数组返回解码器<code>dict</code>；否则使用自定义类型返回</li>
</ul>
<h3 id="示范-1"><a href="#示范-1" class="headerlink" title="示范"></a>示范</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.loads(<span class="string">'["foo", &#123;"bar":["baz", null, 1.0, 2]&#125;]'</span>)</span><br><span class="line">[<span class="string">'foo'</span>, &#123;<span class="string">'bar'</span>: [<span class="string">'baz'</span>, <span class="keyword">None</span>, <span class="number">1.0</span>, <span class="number">2</span>]&#125;]</span><br></pre></td></tr></table></figure>
<h1 id="更新日志"><a href="#更新日志" class="headerlink" title="更新日志"></a>更新日志</h1><ul>
<li>2015年10月30日 初步完成</li>
</ul>

        
        <div class="post-footer">
            
                <div id="eof" class="print-invisible">
                    <hr class="eof">
                </div>
                <div style="float:left;width:50%;text-align:center;margin-bottom:40px;">
                    <a href="/imgs/dachui.jpg" title="微信扫一扫，获取新文章推送" class="fancybox" style="display:block" ;><img
                                alt="微信扫一扫，获取新文章推送" style="display:inline-block;" src="/imgs/dachui.jpg"></a>
          <span class="caption" style="color: #999;display: inline-block;font-size: .9em;text-align: center;">
              微信扫一扫，获取新文章推送
          </span>
                </div>
                <div style="float:left;width:50%;text-align:center;margin-bottom:40px;">
                    <a href="/imgs/wechat.png" title="微信扫一扫，请博主喝咖啡" class="fancybox" style="display:block;"><img
                                alt="微信扫一扫，请博主喝咖啡" style="display:inline-block;" src="/imgs/wechat.png"></a>
          <span class="caption" style="color: #999;display: inline-block;font-size: .9em;text-align: center;">
              微信扫一扫，请博主喝咖啡
          </span>
                </div>
                <div class="copyright" style="clear:both;">
                    <p><span>本文标题:</span><a href="/2015/10/30/python-JSON/">在Python中使用JSON</a></p>
                    <p><span>文章作者:</span><a href="/" title="访问 Xuanwo 的个人博客">Xuanwo</a></p>
                    <p><span>发布时间:</span>2015年10月30日 - 23时10分</p>
                    <p><span>最后更新:</span>2016年6月21日 - 17时06分</p>
                    <p><span>原始链接:</span><a href="/2015/10/30/python-JSON/"
                                            title="在Python中使用JSON">https://xuanwo.org/2015/10/30/python-JSON/</a></p>
                    <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license"
                                                                                   href="http://creativecommons.org/licenses/by-nc/4.0/"
                                                                                   title="Attribution-NonCommercial 4.0 International (CC BY-NC 4.0)">Attribution-NonCommercial
                            4.0</a></p>
                    <p><span>转载请保留以上信息。</span></p>
                </div>
            
            
                <div class="post-tags">
                    
                        <a href="/tags/Software/"> #Software </a>
                    
                        <a href="/tags/Python/"> #Python </a>
                    
                        <a href="/tags/JSON/"> #JSON </a>
                    
                </div>
            
        </div>

    </article>



            
                
    <article class="clearfix">
        <div class="post-date">
            发表于
            <time datetime="2015-10-23T01:03:09+00:00"
                  content="Oct 23 2015">
                Oct 23 2015
            </time>
            &nbsp;|&nbsp;分类于
            
                
                    <a href="/categories/Develop/" rel="index">
                        Develop
                        
                        
                    </a>
                
            
            <span>
            <a href="/2015/10/23/pyquery-intro/#disqus_thread" data-disqus-identifier="2015/10/23/pyquery-intro/">
              <span class="disqus-comment-count" data-disqus-identifier="2015/10/23/pyquery-intro/"></span>
            </a>
          </span>
        </div>
        <h2><a href="/2015/10/23/pyquery-intro/">使用pyQuery解析HTML</a></h2>
        
            <h1 id="pyQuery介绍"><a href="#pyQuery介绍" class="headerlink" title="pyQuery介绍"></a>pyQuery介绍</h1><p>pyquery 可以让你用jquery语法来对xml进行查询。这个API和jquery十分类似。如果利用lxml，pyquery对xml和html的操作将更加快速。</p>
<a id="more"></a>
<h1 id="pyQuery安装"><a href="#pyQuery安装" class="headerlink" title="pyQuery安装"></a>pyQuery安装</h1><blockquote>
<p>首先，你得有一个python环境，最好是类linux的，因为安装pyquery的过程中需要编译某一个包，在windows上比较难解决依赖问题</p>
</blockquote>
<h2 id="安装Python环境"><a href="#安装Python环境" class="headerlink" title="安装Python环境"></a>安装Python环境</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python python-dev python-pip</span><br></pre></td></tr></table></figure>
<ul>
<li><code>python</code> 安装python环境</li>
<li><code>python-dev</code> 安装python开发环境</li>
<li><code>python-pip</code> 安装pip来进行python包管理</li>
</ul>
<h2 id="解决pyQuery所需依赖"><a href="#解决pyQuery所需依赖" class="headerlink" title="解决pyQuery所需依赖"></a>解决pyQuery所需依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libxml2-dev libxslt1-dev libz-dev</span><br></pre></td></tr></table></figure>
<ul>
<li><code>libxml2-dev</code>和<code>libxslt1-dev</code>是编译lxml所需要的包，缺少会导致编译失败</li>
<li>某些情况下会提示<code>/usr/bin/ld: cannot find -lz</code>，所以需要安装<code>libz-dev</code></li>
</ul>
<h2 id="安装pyQuery"><a href="#安装pyQuery" class="headerlink" title="安装pyQuery"></a>安装pyQuery</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyquery</span><br></pre></td></tr></table></figure>
<p>解决了依赖问题之后，就可以进行pyquery的安装了。</p>
<blockquote>
<p>有一个坑点是在虚拟机编译lxml的过程中，如果内存过小会导致编译失败。如果出现错误，请把虚拟机的内存调整至1024M或更大。</p>
</blockquote>
<h1 id="pyQuery使用"><a href="#pyQuery使用" class="headerlink" title="pyQuery使用"></a>pyQuery使用</h1><h2 id="最简样例"><a href="#最简样例" class="headerlink" title="最简样例"></a>最简样例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pyq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;这是标题&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;p id="hi"&gt;Hello&lt;/p&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;li&gt;list1&lt;/li&gt;</span><br><span class="line">            &lt;div class="ha"&gt;</span><br><span class="line">                Cool!</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;li&gt;list2&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">'''</span></span><br><span class="line"></span><br><span class="line">doc = pyq(html)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> doc(<span class="string">'title'</span>) <span class="comment"># 获取 title 标签的源码</span></span><br><span class="line"><span class="comment"># &lt;title&gt;这是标题&lt;/title&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> doc(<span class="string">'title'</span>).text() <span class="comment"># 获取 title 标签的内容</span></span><br><span class="line"><span class="comment"># 这是标题</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> doc(<span class="string">'.ha'</span>).text() <span class="comment"># 获取 class 为 ha 的标签的内容</span></span><br><span class="line"><span class="comment"># Cool!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> doc(<span class="string">'#hi'</span>).text() <span class="comment"># 获取 id 为 hi 的标签的内容</span></span><br><span class="line"><span class="comment"># Hello</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> doc(<span class="string">'p:first'</span>).text() <span class="comment"># 还可以支持伪类</span></span><br><span class="line"></span><br><span class="line">li = doc(<span class="string">'li'</span>) <span class="comment"># 处理多个元素</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> li:</span><br><span class="line">    <span class="keyword">print</span> pyq(i).text()</span><br><span class="line"><span class="comment"># list1</span></span><br><span class="line"><span class="comment"># list2</span></span><br></pre></td></tr></table></figure>
<h2 id="指定网址"><a href="#指定网址" class="headerlink" title="指定网址"></a>指定网址</h2><h3 id="直接访问"><a href="#直接访问" class="headerlink" title="直接访问"></a>直接访问</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pyq</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接访问并获取相关信息</span></span><br><span class="line"><span class="keyword">print</span> pyq(url=<span class="string">'https://www.google.com'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="指定headers"><a href="#指定headers" class="headerlink" title="指定headers"></a>指定headers</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pyq</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以指定headers访问并获取相关信息，好处是不会被某些网站拒绝访问</span></span><br><span class="line"><span class="keyword">print</span> pyq(url=<span class="string">'https://www.google.com'</span>, headers=&#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.71 Safari/537.36'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="指定文件"><a href="#指定文件" class="headerlink" title="指定文件"></a>指定文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line">from pyquery import PyQuery as pyq</span><br><span class="line"></span><br><span class="line">print pyq(filename=&apos;path/to/html/file&apos;).text()</span><br></pre></td></tr></table></figure>
<h2 id="指定lxml文档"><a href="#指定lxml文档" class="headerlink" title="指定lxml文档"></a>指定lxml文档</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line">from pyquery import PyQuery as pyq</span><br><span class="line">from lxml import etree</span><br><span class="line"></span><br><span class="line"># pyquery支持etree的API</span><br><span class="line">print pyq(etree.fromstring(&quot;&lt;html&gt;&lt;/html&gt;&quot;)).text()</span><br></pre></td></tr></table></figure>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="https://github.com/gawel/pyquery" target="_blank" rel="external">gawel/pyquery</a></li>
<li><a href="http://www.powerxing.com/python-use-pyquery-to-parse-html/" target="_blank" rel="external">Python使用pyQuery解析HTML内容</a></li>
<li><a href="http://stackoverflow.com/questions/26053982/error-setup-script-exited-with-error-command-x86-64-linux-gnu-gcc-failed-wit" target="_blank" rel="external">error: Setup script exited with error: command ‘x86_64-linux-gnu-gcc’ failed with exit status 1</a></li>
<li><a href="http://stackoverflow.com/questions/24455238/lxml-installation-error-ubuntu-14-04-internal-compiler-error" target="_blank" rel="external">lxml installation error ubuntu 14.04 (internal compiler error)</a></li>
<li><a href="http://stackoverflow.com/a/22256546" target="_blank" rel="external">can’t installing lxml on Ubuntu 12.04</a></li>
</ul>
<h1 id="更新日志"><a href="#更新日志" class="headerlink" title="更新日志"></a>更新日志</h1><ul>
<li>2015年10月23日 初步完成</li>
</ul>

        
        <div class="post-footer">
            
                <div id="eof" class="print-invisible">
                    <hr class="eof">
                </div>
                <div style="float:left;width:50%;text-align:center;margin-bottom:40px;">
                    <a href="/imgs/dachui.jpg" title="微信扫一扫，获取新文章推送" class="fancybox" style="display:block" ;><img
                                alt="微信扫一扫，获取新文章推送" style="display:inline-block;" src="/imgs/dachui.jpg"></a>
          <span class="caption" style="color: #999;display: inline-block;font-size: .9em;text-align: center;">
              微信扫一扫，获取新文章推送
          </span>
                </div>
                <div style="float:left;width:50%;text-align:center;margin-bottom:40px;">
                    <a href="/imgs/wechat.png" title="微信扫一扫，请博主喝咖啡" class="fancybox" style="display:block;"><img
                                alt="微信扫一扫，请博主喝咖啡" style="display:inline-block;" src="/imgs/wechat.png"></a>
          <span class="caption" style="color: #999;display: inline-block;font-size: .9em;text-align: center;">
              微信扫一扫，请博主喝咖啡
          </span>
                </div>
                <div class="copyright" style="clear:both;">
                    <p><span>本文标题:</span><a href="/2015/10/23/pyquery-intro/">使用pyQuery解析HTML</a></p>
                    <p><span>文章作者:</span><a href="/" title="访问 Xuanwo 的个人博客">Xuanwo</a></p>
                    <p><span>发布时间:</span>2015年10月23日 - 01时10分</p>
                    <p><span>最后更新:</span>2016年6月21日 - 17时06分</p>
                    <p><span>原始链接:</span><a href="/2015/10/23/pyquery-intro/"
                                            title="使用pyQuery解析HTML">https://xuanwo.org/2015/10/23/pyquery-intro/</a></p>
                    <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license"
                                                                                   href="http://creativecommons.org/licenses/by-nc/4.0/"
                                                                                   title="Attribution-NonCommercial 4.0 International (CC BY-NC 4.0)">Attribution-NonCommercial
                            4.0</a></p>
                    <p><span>转载请保留以上信息。</span></p>
                </div>
            
            
                <div class="post-tags">
                    
                        <a href="/tags/Software/"> #Software </a>
                    
                        <a href="/tags/Python/"> #Python </a>
                    
                        <a href="/tags/HTML/"> #HTML </a>
                    
                </div>
            
        </div>

    </article>



            
            
        </div>
    </div>

    </div>
    <footer>
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-sm-2 col-md-2 footer-widget">
                    <h3>Statistics</h3>

                    <span>No BB, just do it!</span>

                    <div class="stats">
                        <div class="line">
                            <span class="counter">392</span>
                            <span class="caption">Articles</span>
                        </div>
                        <div class="line">
                            <span class="counter">7</span>
                            <span class="caption">Categories</span>
                        </div>
                        <div class="line">
                            <span class="counter">60</span>
                            <span class="caption">Tags</span>
                        </div>
                    </div>
                </div>

                <div class="col-sm-4 col-md-4 footer-widget">
                    <h3>Recent posts</h3>
                    <div class="post-recent-widget">
                        <div class="row">
                            <div class="col-sm-12">
                                <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/06/16/jade_ims/">马可波罗珠宝进销存系统开发手记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/03/owncloud-on-qingcloud/">在QingCloud上部署弹性扩容的OwnCloud</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/29/learn-from-qingchat/">我从Qingchat中学到的教训</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/09/msp430g2553-bellring/">基于MSP430G2553的打铃系统开发手记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/13/gitlab-install-intro/">Gitlab部署和汉化以及简单运维</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/04/docopt-intro/">docopt——好用的Python命令行参数解释器</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/01/qingchat-intro/">微信多群直播的新探索——Qingchat</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/13/gout/">罹患痛风感言</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/12/neovim-slow-upgrade/">Neovim慢速升级攻略</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/28/wechat-remove/">微信群重复人员识别</a></li></ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-sm-6 col-md-6 footer-widget clearfix">
                    <h3>Tags</h3>
                    <ul class="tags">
                        
                            <li><a href="/tags/Google/">Google</a></li>
                        
                            <li><a href="/tags/CloudFlare/">CloudFlare</a></li>
                        
                            <li><a href="/tags/FuckWall/">FuckWall</a></li>
                        
                            <li><a href="/tags/PHP/">PHP</a></li>
                        
                            <li><a href="/tags/Web/">Web</a></li>
                        
                            <li><a href="/tags/Event/">Event</a></li>
                        
                            <li><a href="/tags/Github/">Github</a></li>
                        
                            <li><a href="/tags/CI/">CI</a></li>
                        
                            <li><a href="/tags/阅读/">阅读</a></li>
                        
                            <li><a href="/tags/Markdown/">Markdown</a></li>
                        
                            <li><a href="/tags/Hexo/">Hexo</a></li>
                        
                            <li><a href="/tags/Github-Pages/">Github-Pages</a></li>
                        
                            <li><a href="/tags/Blog/">Blog</a></li>
                        
                            <li><a href="/tags/VPS/">VPS</a></li>
                        
                            <li><a href="/tags/Software/">Software</a></li>
                        
                            <li><a href="/tags/Read/">Read</a></li>
                        
                            <li><a href="/tags/Windows/">Windows</a></li>
                        
                            <li><a href="/tags/Android/">Android</a></li>
                        
                            <li><a href="/tags/C/">C</a></li>
                        
                            <li><a href="/tags/Database/">Database</a></li>
                        
                            <li><a href="/tags/复习/">复习</a></li>
                        
                            <li><a href="/tags/Nodejs/">Nodejs</a></li>
                        
                            <li><a href="/tags/python/">python</a></li>
                        
                            <li><a href="/tags/qingchat/">qingchat</a></li>
                        
                            <li><a href="/tags/运维/">运维</a></li>
                        
                            <li><a href="/tags/CUGBLUG/">CUGBLUG</a></li>
                        
                            <li><a href="/tags/Gitlab/">Gitlab</a></li>
                        
                            <li><a href="/tags/科普/">科普</a></li>
                        
                            <li><a href="/tags/Information/">Information</a></li>
                        
                            <li><a href="/tags/CUGB/">CUGB</a></li>
                        
                            <li><a href="/tags/项目/">项目</a></li>
                        
                            <li><a href="/tags/Python/">Python</a></li>
                        
                            <li><a href="/tags/Flask/">Flask</a></li>
                        
                            <li><a href="/tags/HTML/">HTML</a></li>
                        
                            <li><a href="/tags/JavaScript/">JavaScript</a></li>
                        
                            <li><a href="/tags/实习/">实习</a></li>
                        
                            <li><a href="/tags/QingCloud/">QingCloud</a></li>
                        
                            <li><a href="/tags/单片机/">单片机</a></li>
                        
                            <li><a href="/tags/Work/">Work</a></li>
                        
                            <li><a href="/tags/爬虫/">爬虫</a></li>
                        
                            <li><a href="/tags/Hardware/">Hardware</a></li>
                        
                            <li><a href="/tags/vim/">vim</a></li>
                        
                            <li><a href="/tags/Video/">Video</a></li>
                        
                            <li><a href="/tags/JSON/">JSON</a></li>
                        
                            <li><a href="/tags/字符串/">字符串</a></li>
                        
                            <li><a href="/tags/Linux/">Linux</a></li>
                        
                            <li><a href="/tags/SSH/">SSH</a></li>
                        
                            <li><a href="/tags/Together/">Together</a></li>
                        
                            <li><a href="/tags/虚拟化/">虚拟化</a></li>
                        
                            <li><a href="/tags/协作/">协作</a></li>
                        
                            <li><a href="/tags/Ubuntu/">Ubuntu</a></li>
                        
                            <li><a href="/tags/翻译/">翻译</a></li>
                        
                            <li><a href="/tags/Wiki/">Wiki</a></li>
                        
                            <li><a href="/tags/Develop/">Develop</a></li>
                        
                            <li><a href="/tags/Mac/">Mac</a></li>
                        
                            <li><a href="/tags/Oracle/">Oracle</a></li>
                        
                            <li><a href="/tags/VB/">VB</a></li>
                        
                            <li><a href="/tags/微信/">微信</a></li>
                        
                            <li><a href="/tags/Sports/">Sports</a></li>
                        
                            <li><a href="/tags/Games/">Games</a></li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="copyright">
        <div class="container">
            <p class="pull-left">Designed by <a href="http://xuanwo.org">Xuanwo.</a> Powered by <a
                        href="https://hexo.io">Hexo.</a></p>
            <ul class="social-links pull-right">
                <li><a href="https://twitter.com/OnlyXuanwo"><i class="fa fa-twitter"></i></a></li>
                <li><a href="https://www.facebook.com/onlyxuanwo"><i class="fa fa-facebook"></i></a></li>
                <li><a href="https://plus.google.com/u/0/116093463258836167644"><i class="fa fa-google-plus"></i></a>
                </li>
            </ul>
        </div>
    </div>
</footer>

<script type="text/javascript" src="/dist/js/jquery.min.js"></script>
<script type="text/javascript" src="/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/dist/js/wow.min.js"></script>
<script type="text/javascript" src="/dist/js/custom.js"></script>
<script id="dsq-count-scr" src="//only0god.disqus.com/count.js" async></script>
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-51515330-1', 'auto');
    ga('send', 'pageview');
</script>
</div>
<script type="text/javascript">
    $("img").addClass("img-responsive");
</script>
</body>
</html>